<!--
SPDX-FileCopyrightText: 2024 University of Applied Sciences Osnabrück
SPDX-FileContributor: Andreas Schliebitz
SPDX-FileContributor: Henri Graf
SPDX-FileContributor: Jonas Tüpker
SPDX-FileContributor: Lukas Hesse
SPDX-FileContributor: Maik Fruhner
SPDX-FileContributor: Prof. Dr.-Ing. Heiko Tapken
SPDX-FileContributor: Tobias Wamhof

SPDX-License-Identifier: AGPL-3.0-or-later
-->

# Backend

The Webserver-Backend for Agri-Gaia powered by FastAPI.

## Developer Documentation

### Working on the data model

The backend server uses SQLAlchemy as ORM framework and PostgreSQL as the DBMS.

#### Database migrations

SQLAlchemy uses Alembic for database migrations. The database migrations are applied automatically at the start of the backend server if the `MIGRATE_DB` environment variable is set.

If the data model is changed a migration file can be autogenerated with `alembic revision --autogenerate -m "message"`.

### Inspecting PostgreSQL tables

While developing, it might be helpful to run SQL queries against the `postgres_backend` container. This can be achieved using the following `docker exec` command:

```bash
docker exec agri_gaia-postgres_backend-1 \
  psql \
  postgresql://user:pass@postgres_backend:5432/postgres \
  -c "SELECT * FROM datasets"
```

Just replace the example query after `-c` with your own custom SQL expression.
